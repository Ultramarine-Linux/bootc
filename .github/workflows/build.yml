name: Build bootc images

on:
  push:
  pull_request:
    branches:
      - main
      - ng
  schedule:
    - cron: "0 1 * * TUE" #Â Every Tuesday at 1am UTC
  merge_group:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref || github.run_id }}
  cancel-in-progress: true

jobs:
  build-base:
    uses: ./.github/workflows/reusable-build-image.yml
    secrets: inherit
    with:
      image-name: ultramarine
      flavor: base
  
  build-gnome:
    uses: ./.github/workflows/reusable-build-image.yml
    needs: build-base
    secrets: inherit
    with:
      image-name: ultramarine
      flavor: gnome
      from: ${{ needs.build-base.outputs.manifest }}